# IEntryPoint
[Git Source](https://github.com/TrueWallet/contracts/blob/db2e75cb332931da5fdaa38bec9e4d367be1d851/src/interfaces/IEntryPoint.sol)

**Inherits:**
[IStakeManager](/src/interfaces/IStakeManager.sol/interface.IStakeManager.md), [INonceManager](/src/interfaces/INonceManager.sol/interface.INonceManager.md)


## Functions
### handleOps

Execute a batch of UserOperation.
no signature aggregator is used.
if any account requires an aggregator (that is, it returned an aggregator when
performing simulateValidation), then handleAggregatedOps() must be used instead.


```solidity
function handleOps(UserOperation[] calldata ops, address payable beneficiary) external;
```
**Parameters**

|Name|Type|Description|
|----|----|-----------|
|`ops`|`UserOperation[]`|the operations to execute|
|`beneficiary`|`address payable`|the address to receive the fees|


### handleAggregatedOps

Execute a batch of UserOperation with Aggregators


```solidity
function handleAggregatedOps(UserOpsPerAggregator[] calldata opsPerAggregator, address payable beneficiary) external;
```
**Parameters**

|Name|Type|Description|
|----|----|-----------|
|`opsPerAggregator`|`UserOpsPerAggregator[]`|the operations to execute, grouped by aggregator (or address(0) for no-aggregator accounts)|
|`beneficiary`|`address payable`|the address to receive the fees|


### getUserOpHash

Generate a request Id - unique identifier for this request.
the request ID is a hash over the content of the userOp (except the signature), the entrypoint and the chainid.


```solidity
function getUserOpHash(UserOperation calldata userOp) external view returns (bytes32);
```

### simulateValidation

Simulate a call to account.validateUserOp and paymaster.validatePaymasterUserOp.

*this method always revert. Successful result is ValidationResult error. other errors are failures.*

*The node must also verify it doesn't use banned opcodes, and that it doesn't reference storage outside the account's data.*


```solidity
function simulateValidation(UserOperation calldata userOp) external;
```
**Parameters**

|Name|Type|Description|
|----|----|-----------|
|`userOp`|`UserOperation`|the user operation to validate.|


### getSenderAddress

Get counterfactual sender address.
Calculate the sender contract address that will be generated by the initCode and salt in the UserOperation.
this method always revert, and returns the address in SenderAddressResult error


```solidity
function getSenderAddress(bytes memory initCode) external;
```
**Parameters**

|Name|Type|Description|
|----|----|-----------|
|`initCode`|`bytes`|the constructor code to be passed into the UserOperation.|


### simulateHandleOp

Simulate full execution of a UserOperation (including both validation and target execution)
this method will always revert with "ExecutionResult".
it performs full validation of the UserOperation, but ignores signature error.
an optional target address is called after the userop succeeds, and its value is returned
(before the entire call is reverted)
Note that in order to collect the the success/failure of the target call, it must be executed
with trace enabled to track the emitted events.


```solidity
function simulateHandleOp(UserOperation calldata op, address target, bytes calldata targetCallData) external;
```
**Parameters**

|Name|Type|Description|
|----|----|-----------|
|`op`|`UserOperation`|the UserOperation to simulate|
|`target`|`address`|if nonzero, a target address to call after userop simulation. If called, the targetSuccess and targetResult are set to the return from that call.|
|`targetCallData`|`bytes`|callData to pass to target address|


## Events
### UserOperationEvent
An event emitted after each successful request


```solidity
event UserOperationEvent(
    bytes32 indexed userOpHash,
    address indexed sender,
    address indexed paymaster,
    uint256 nonce,
    bool success,
    uint256 actualGasCost,
    uint256 actualGasUsed
);
```

### AccountDeployed
Account "sender" was deployed.


```solidity
event AccountDeployed(bytes32 indexed userOpHash, address indexed sender, address factory, address paymaster);
```

### UserOperationRevertReason
An event emitted if the UserOperation "callData" reverted with non-zero length


```solidity
event UserOperationRevertReason(bytes32 indexed userOpHash, address indexed sender, uint256 nonce, bytes revertReason);
```

### BeforeExecution
An event emitted by handleOps(), before starting the execution loop.
any event emitted before this event, is part of the validation.


```solidity
event BeforeExecution();
```

### SignatureAggregatorChanged
signature aggregator used by the following UserOperationEvents within this bundle.


```solidity
event SignatureAggregatorChanged(address indexed aggregator);
```

## Errors
### FailedOp
A custom revert error of handleOps, to identify the offending op.
NOTE: if simulateValidation passes successfully, there should be no reason for handleOps to fail on it.


```solidity
error FailedOp(uint256 opIndex, string reason);
```

### SignatureValidationFailed
Error case when a signature aggregator fails to verify the aggregated signature it had created.


```solidity
error SignatureValidationFailed(address aggregator);
```

### ValidationResult
Successful result from simulateValidation.


```solidity
error ValidationResult(ReturnInfo returnInfo, StakeInfo senderInfo, StakeInfo factoryInfo, StakeInfo paymasterInfo);
```

### ValidationResultWithAggregation
Successful result from simulateValidation, if the account returns a signature aggregator


```solidity
error ValidationResultWithAggregation(
    ReturnInfo returnInfo,
    StakeInfo senderInfo,
    StakeInfo factoryInfo,
    StakeInfo paymasterInfo,
    AggregatorStakeInfo aggregatorInfo
);
```

### SenderAddressResult
Return value of getSenderAddress


```solidity
error SenderAddressResult(address sender);
```

### ExecutionResult
Return value of simulateHandleOp


```solidity
error ExecutionResult(
    uint256 preOpGas, uint256 paid, uint48 validAfter, uint48 validUntil, bool targetSuccess, bytes targetResult
);
```

## Structs
### UserOpsPerAggregator

```solidity
struct UserOpsPerAggregator {
    UserOperation[] userOps;
    IAggregator aggregator;
    bytes signature;
}
```

### ReturnInfo
Gas and return values during simulation


```solidity
struct ReturnInfo {
    uint256 preOpGas;
    uint256 prefund;
    bool sigFailed;
    uint48 validAfter;
    uint48 validUntil;
    bytes paymasterContext;
}
```

### AggregatorStakeInfo
Returned aggregated signature info.
The aggregator returned by the account, and its current stake.


```solidity
struct AggregatorStakeInfo {
    address aggregator;
    StakeInfo stakeInfo;
}
```

